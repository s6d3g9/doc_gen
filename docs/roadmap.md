# Roadmap разработки (временный план)

Этот документ — **временный план разработки**. Он нужен, чтобы двигаться последовательно и архитектурно корректно: сначала стабилизируем доменные сущности и API, затем UI, затем прод‑готовность.

Принципы:

- **Postgres — источник истины** (документы/версии/шаблоны/поля/генерации/таски/связи календаря).
- **Redis — только очередь** (эпемерные payload’ы). Статусы и результаты — в Postgres + artifacts.
- **Artifacts append-only**: результаты генерации/AI/загрузок пишем в файловое хранилище, в БД — ссылки и метаданные.
- **Frontend зависит от контрактов API**: сначала минимально достаточные эндпоинты/ответы, затем экраны.

## Этап 0 (сейчас): базовая инфраструктура

Сделано:

- Docker Compose: Postgres + Redis + backend + agents.
- Backend: документы/версии, шаблоны/поля/версии, генерация, AI (sync/async), tasks, calendar (dry-run/реальный), artifacts.
- Frontend: Vite/React каркас, темы, базовый layout + панель «Свойства».

## Этап 1 (1–3 дня): стабилизация API-контрактов

Цель: чтобы frontend мог безопасно строиться на API без «ломающих» правок.

Задачи:

- Уточнить минимальные DTO для UI:
  - список документов (включая последний version_id, если нужно UI)
  - получение версии + текст/метаданные
  - генерация: отдавать удобный URL/endpoint для скачивания артефакта
- Добавить базовые ошибки/валидации (единый формат ошибок, 404/400).
- Документировать примеры запросов/ответов (коротко в backend/README или docs/architecture).

Критерии готовности:

- Есть e2e сценарий: создать документ → создать шаблон → сгенерировать документ → получить артефакт.
- Async AI: `POST /ai/*?async=true` + polling `GET /tasks/{id}` работает стабильно.

## Этап 2 (3–7 дней): UI «Документы» (первый реальный экран)

Цель: дать пользователю полезный функционал без сложных редакторов.

Задачи:

- Экран «Документы»:
  - список документов
  - создание из текста
  - загрузка файла (пока без парсинга формата)
- Экран «Документ»:
  - список версий
  - просмотр версии (plain text, если `text/*`, иначе placeholder)
- Интеграция с backend base URL через env (например, `VITE_API_BASE_URL`).

Критерии готовности:

- Можно создать документ и увидеть его версии.
- UI выдерживает resize и zoom согласно требованиям (см. [README.ui-rules.md](../README.ui-rules.md)).

## Этап 3 (3–7 дней): UI «Шаблоны и генерация»

Цель: пользователь может создавать шаблон, настраивать поля и генерировать документ.

Задачи:

- Экран «Шаблоны»:
  - список шаблонов
  - создание шаблона
  - создание/просмотр версии шаблона
  - список/редактирование полей шаблона
- Экран «Генерация»:
  - форма данных по полям
  - `POST /generate`
  - ссылка/кнопка скачивания результата

Критерии готовности:

- Генерация детерминированна, ошибки шаблона понятны пользователю.

## Этап 4 (2–5 дней): Calendar sync (прод‑готовность)

Цель: устойчивое добавление дат/диапазонов в Google Calendar.

Задачи:

- UI/endpoint для запуска sync и просмотра привязанных событий.
- Уточнить политику идемпотентности и удаления/обновления событий.
- Документировать настройку кредов для docker (mount + env).

Критерии готовности:

- Повторный sync не создаёт дубликаты.
- Есть dry-run режим для проверки извлечения дат.

## Этап 5 (1–2 недели): Auth + multi-tenant (если нужно)

Цель: доступ к документам и настройкам по пользователям/организациям.

Задачи:

- Выбрать минимальный auth (JWT/cookie) и реализовать в backend.
- Ввести scoping по organization/user для документов/шаблонов.
- UI: login + базовые ограничения.

Критерии готовности:

- Нельзя получить чужие документы/шаблоны.

## Этап 6 (непрерывно): качество и эксплуатация

- Тесты: минимум smoke/integration для ключевых сценариев.
- Миграции (Alembic) вместо `create_all` (когда начнём менять схему активно).
- Observability: структурные логи, healthchecks, базовые метрики.

## Что делаем следующим (выбор по архитектуре)

Самый правильный следующий шаг — **Этап 1: стабилизация API-контрактов**, чтобы потом UI не переписывать.

После этого — **Этап 2: Документы** (самая быстрая пользовательская ценность), затем **Этап 3: Шаблоны/Генерация**.
