# ТЗ: путь пользователя и UI (Doczilla-like)

Документ фиксирует **минимальный** UX, который мы строим, чтобы он был похож на Doczilla AI по основным сценариям: работа с документами, редактор, AI-команды/чат, версии.

## 1) Роли и предпосылки

### Роли
- **Пользователь**: работает с документами, запускает AI-команды.
- **Админ** (опционально, позже): управляет тарифами/доступами/ключами провайдера.

### Предпосылки (технические)
- `frontend/` общается с `backend/` по REST.
- Документы и версии: Postgres.
- Очереди задач: Redis.
- Артефакты (исходные файлы/результаты AI): диск.

## 2) Вход на сайт (Auth)

### Цель
Пользователь может зайти в систему и получить доступ к своим документам.

### Минимальные экраны
1. **Страница входа**
   - Поле `email`
   - Поле `password`
   - Кнопка `Войти`
2. **Сессия**
   - После успешного входа: редирект в `Библиотека документов`.
   - При истечении сессии: редирект на `Вход`.

### Минимальные требования
- Хранить токен/сессию (например, httpOnly cookie или bearer token) — конкретика выбирается при реализации.
- Для MVP допускается один провайдер auth (email/password).

## 3) Главное меню приложения (App Shell)

### Структура
Слева — основная навигация:
- **Документы** (библиотека)
- **Copilot / AI** (подключение провайдера, настройки)

Вверху — контекстная панель (название текущего документа, статус сохранения).

## 4) Меню подключения Copilot (AI provider settings)

### Цель
Пользователь/организация подключают LLM-провайдера, чтобы AI-команды работали.

### Экран «Copilot / AI»
- Переключатель/селектор **провайдера**:
  - `none` (AI выключен)
  - `openai-compatible`
- Поля (если выбран openai-compatible):
  - `Base URL`
  - `API Key`
  - `Model`
- Кнопка `Проверить подключение`
  - Делает test call в backend, backend проверяет доступность провайдера.

### Правила
- `API Key` в UI отображать как password field.
- В дальнейшем эти настройки могут храниться на стороне backend (предпочтительно), а UI только управляет ими.

## 5) Меню хранения документов (Библиотека)

### Цель
Пользователь видит список документов, может создать новый, открыть, загрузить файл, управлять версиями.

### Экран «Документы»
- Список документов (минимум: `title`, `created_at`).
- Кнопки:
  - `Создать документ`
  - `Загрузить документ` (создаёт документ из файла)

### Создание документа (2 сценария)
1. **Загрузка файла**
   - Выбор файла (`.docx`, `.pdf`, `.txt` минимум)
   - Поле `Название`
   - `Создать`
2. **Создание из текста**
   - Поле `Название`
   - Текстовое поле (первичная версия)
   - `Создать`

### После создания
- Открывается **редактор документа**.

## 6) Редактор документа с чатботом (главный экран)

### Цель
Пользователь редактирует документ и применяет AI-команды к документу целиком или к выделенному фрагменту.

### Лэйаут (минимальный)
- **Центр**: область документа (текст/предпросмотр).
- **Правая панель**: чат/команды AI (Copilot).
- **Левая панель** (опционально в рамках редактора): версии документа.

### Секции редактора

#### 6.1 Область документа
- Отображает текущую версию документа.
- Поддерживает выделение текста (для команд “к выделенному”).

> Примечание: в MVP можно начать с plain text представления. Полноценное сохранение форматирования `.docx` — позже.

#### 6.2 Панель версий
- Список версий (дата/время).
- Действия:
  - `Создать новую версию` (загрузить файл или вставить текст)
  - `Сравнить с...` (выбрать вторую версию)

#### 6.3 Панель Copilot (чат)
- История сообщений (контекст текущего документа/выделения)
- Поле ввода
- Кнопка `Отправить`
- Быстрые команды (кнопки):
  - `Резюмировать документ`
  - `Ключевые положения`
  - `Обязательства сторон`
  - `Извлечь данные (даты/суммы/стороны)`
  - `Сравнить версии`
  - `Перевод 2 колонки (RU/EN)`

### Правила работы чата
- Контекст по умолчанию: **текущая версия документа**.
- Если есть выделение текста: команда применяется к **выделению** (если команда поддерживает).
- Длинные операции должны уметь работать асинхронно:
  - UI показывает `Выполняется...`
  - UI опрашивает статус задачи
  - результат появляется в панели чата и/или как новый артефакт

## 7) Путь ввода данных для составления базового документа

### Цель
Пользователь вводит структурированные данные (поля), и система генерирует базовый документ.

### UX сценарий (MVP)
1. В библиотеке документов: `Создать документ` → `Создать по форме`.
2. Экран формы содержит:
   - **Тип документа** (селектор) — минимум 1–2 типа на старте.
   - Набор полей (в зависимости от типа):
     - Сторона 1: название, ИНН/ОГРН (если РФ), адрес, представитель
     - Сторона 2: название, ИНН/ОГРН, адрес, представитель
     - Предмет договора
     - Цена/сумма и валюта
     - Сроки (дата начала/окончания)
     - Порядок оплаты (текст/выбор)
3. `Сгенерировать`.
4. Результат открывается в редакторе как первая версия.

### Алгоритм (backend)
- Backend собирает введённые поля в JSON.
- Backend формирует промпт “сгенерировать документ по данным” и вызывает AI провайдера.
- Сохраняет результат как артефакт и создаёт `DocumentVersion`.

> Важно: конкретный набор типов документов и полей фиксируется отдельно в "Справочнике шаблонов" (добавим позже, когда определим домен).

## 8) Требования к состояниям и ошибкам

### Библиотека
- Пустое состояние: "Нет документов" + CTA создать/загрузить.
- Ошибка загрузки: показать текст ошибки, предложить повторить.

### Редактор
- Если AI отключён (`MODEL_PROVIDER=none`):
  - панель чата доступна, но ответы возвращают "AI disabled".

### Async операции
- Статусы: `pending` → `running` → `succeeded|failed`.
- В случае `failed`: показывать `error` и кнопку `Повторить`.

## 9) Мэппинг на текущий backend scaffold

Сейчас в backend уже есть базовые эндпоинты:
- `POST /documents` (создание из файла/текста)
- `POST /documents/{document_id}/versions`
- `POST /ai/summarize` (sync/async)
- `POST /ai/compare` (sync/async)
- `POST /ai/translate/bilingual` (sync/async)
- `GET /tasks/{task_id}`

Чтобы покрыть ТЗ полностью, нужны будут дополнительные эндпоинты (позже):
- Auth (`/auth/login`, `/auth/logout`, `/auth/me`)
- Документы: list/get (`GET /documents`, `GET /documents/{id}`)
- Версии: list/get (`GET /documents/{id}/versions`)
- Editor content: structured content for `.docx` (если делаем rich editor)
- Form-based generation: `POST /documents/from-form`
